============================================================
  mPBPK Training Pipeline
============================================================

[1] Generating virtual drug-patient simulations...
[OK] Loaded 97 alleles from functionality reference
[OK] Loaded frequencies for 5 populations (403 allele-pop pairs)
[OK] Injected CNV frequencies for UM phenotype support
[OK] Loaded PharmVar haplotypes: 4458 rows
[OK] Parsed 171 unique star alleles
[OK] Parsed 381 unique variants
Generated 500 drug candidates
Populations: ['EUR', 'EAS', 'AFR', 'AMR', 'SAS']
Patients per population: 20
Total simulations: 50,000
  Processing drug 1/500...
  Processing drug 11/500...
  Processing drug 21/500...
  Processing drug 31/500...
  Processing drug 41/500...
  Processing drug 51/500...
  Processing drug 61/500...
  Processing drug 71/500...
  Processing drug 81/500...
  Processing drug 91/500...
  Processing drug 101/500...
  Processing drug 111/500...
  Processing drug 121/500...
  Processing drug 131/500...
  Processing drug 141/500...
  Processing drug 151/500...
  Processing drug 161/500...
  Processing drug 171/500...
  Processing drug 181/500...
  Processing drug 191/500...
  Processing drug 201/500...
  Processing drug 211/500...
  Processing drug 221/500...
  Processing drug 231/500...
  Processing drug 241/500...
  Processing drug 251/500...
  Processing drug 261/500...
  Processing drug 271/500...
  Processing drug 281/500...
  Processing drug 291/500...
  Processing drug 301/500...
  Processing drug 311/500...
  Processing drug 321/500...
  Processing drug 331/500...
  Processing drug 341/500...
  Processing drug 351/500...
  Processing drug 361/500...
  Processing drug 371/500...
  Processing drug 381/500...
  Processing drug 391/500...
  Processing drug 401/500...
  Processing drug 411/500...
  Processing drug 421/500...
  Processing drug 431/500...
  Processing drug 441/500...
  Processing drug 451/500...
  Processing drug 461/500...
  Processing drug 471/500...
  Processing drug 481/500...
  Processing drug 491/500...

Completed 50,000 simulations
Efficacy success rate: 40.5%
Toxicity risk rate: 56.4%
    Generated: 50000 samples
    Columns: ['drug_id', 'log_KD', 'log_dose', 'charge', 'log_MW', 'log_T0', 'log_halflife', 'population', 'phenotype', 'activity_score', 'cl_multiplier', 'TO_trough', 'C_max', 'AUC', 'efficacy_success', 'exposure_toxicity_risk', 'TO_trough_noisy']
    Efficacy Success: 20258 (40.5%)

[2] Saving training data...
Saved training data to:
  - D:\KTaivle\Big_Project\data\processed\mpbpk_training_data_20260127_135915.csv
    Saved to: D:\KTaivle\Big_Project\data\processed\mpbpk_training_data_20260127_135915.csv

[3] Training ML models...
Loading data from: D:\KTaivle\Big_Project\data\processed\mpbpk_training_data_20260127_135915.csv
Dataset size: 50000 samples
Features: 15
Class distribution: [29742 20258]
Applying SMOTE for class balancing...
After SMOTE: 47588 samples

==================================================
Training Decision Tree...

Decision Tree Results:
  Accuracy:  0.723
  Precision: 0.621
  Recall:    0.813
  F1 Score:  0.704
  ROC-AUC:   0.799

==================================================
Training Random Forest...

Random Forest Results:
  Accuracy:  0.720
  Precision: 0.613
  Recall:    0.841
  F1 Score:  0.709
  ROC-AUC:   0.803

==================================================
Running 5-Fold Cross-Validation...
Decision Tree CV F1: 0.707 ± 0.004
Random Forest CV F1: 0.709 ± 0.004

    Decision Tree:
Traceback (most recent call last):
  File "D:\KTaivle\Big_Project\scripts\train_mpbpk.py", line 76, in <module>
    main()
    ~~~~^^
  File "D:\KTaivle\Big_Project\scripts\train_mpbpk.py", line 49, in main
    print(f"      Accuracy: {results['dt_results']['accuracy']:.3f}")
                             ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'dt_results'
